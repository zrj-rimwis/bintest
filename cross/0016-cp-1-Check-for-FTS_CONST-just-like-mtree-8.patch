From 4f4b1cfd04c0e68093fa2a1ad9f48d105e584557 Mon Sep 17 00:00:00 2001
From: zrj <rimvydas.jasinskas@gmail.com>
Date: Sun, 2 Feb 2020 12:36:09 +0200
Subject: [PATCH 16/22] cp(1): Check for FTS_CONST just like mtree(8).

 For compatibility with OpenBSD.
---
 bin/cp/cp.c | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/bin/cp/cp.c b/bin/cp/cp.c
index ae299cf08f..008fb58ab4 100644
--- a/bin/cp/cp.c
+++ b/bin/cp/cp.c
@@ -65,6 +65,12 @@
                 *--(p).p_end = 0;					\
 }
 
+#if defined(__FreeBSD__) || defined(__DragonFly__)
+#define	FTS_CONST const
+#else
+#define	FTS_CONST
+#endif
+
 static char emptystring[] = "";
 
 PATH_T to = { to.p_path, emptystring, "" };
@@ -76,7 +82,7 @@ volatile sig_atomic_t info;
 enum op { FILE_TO_FILE, FILE_TO_DIR, DIR_TO_DNE };
 
 static int copy(char *[], enum op, int);
-static int mastercmp (const FTSENT * const *, const FTSENT * const *);
+static int mastercmp (const FTSENT *FTS_CONST *, const FTSENT *FTS_CONST *);
 #ifdef SIGINFO
 static void siginfo (int);
 #endif
@@ -486,7 +492,7 @@ copy(char *argv[], enum op type, int fts_options)
  *	files first reduces seeking.
  */
 static int
-mastercmp(const FTSENT * const *a, const FTSENT * const *b)
+mastercmp(const FTSENT *FTS_CONST *a, const FTSENT *FTS_CONST *b)
 {
 	int a_info, b_info;
 
-- 
2.25.0


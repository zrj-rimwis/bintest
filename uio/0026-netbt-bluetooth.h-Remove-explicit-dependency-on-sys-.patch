From 5369649a673a94296def9a88dd1669cc4c85979e Mon Sep 17 00:00:00 2001
From: zrj <rimvydas.jasinskas@gmail.com>
Date: Tue, 22 Oct 2019 11:02:17 +0300
Subject: [PATCH 26/39] <netbt/bluetooth.h>: Remove explicit dependency on
 <sys/malloc.h>.

---
 sys/netbt/bluetooth.h      | 3 ++-
 sys/netbt/hci_misc.c       | 1 -
 sys/netbt/l2cap_upper.c    | 1 +
 sys/netbt/rfcomm_dlc.c     | 1 +
 sys/netbt/rfcomm_session.c | 1 +
 sys/netbt/rfcomm_upper.c   | 2 +-
 sys/netbt/sco_upper.c      | 1 +
 7 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/sys/netbt/bluetooth.h b/sys/netbt/bluetooth.h
index 42d8beb359..54cd927c96 100644
--- a/sys/netbt/bluetooth.h
+++ b/sys/netbt/bluetooth.h
@@ -104,10 +104,11 @@ struct sockaddr_bt {
 #define BDADDR_ANY	((const bdaddr_t *) "\000\000\000\000\000")
 
 #ifdef _KERNEL
-#include <sys/malloc.h>
 #include <sys/bus.h>
 
+#ifdef MALLOC_DECLARE
 MALLOC_DECLARE(M_BLUETOOTH);
+#endif
 
 /*
  * Bluetooth Protocol API callback methods
diff --git a/sys/netbt/hci_misc.c b/sys/netbt/hci_misc.c
index 29af609922..7e92564533 100644
--- a/sys/netbt/hci_misc.c
+++ b/sys/netbt/hci_misc.c
@@ -1,4 +1,3 @@
-/* $DragonFly: src/sys/netbt/hci_misc.c,v 1.2 2008/03/18 13:41:42 hasso Exp $ */
 /* $OpenBSD: src/sys/netbt/hci_misc.c,v 1.2 2008/02/24 21:34:48 uwe Exp $ */
 /* $NetBSD: hci_misc.c,v 1.3 2007/09/16 19:59:30 plunky Exp $ */
 
diff --git a/sys/netbt/l2cap_upper.c b/sys/netbt/l2cap_upper.c
index b7406e6eef..2b27b726ba 100644
--- a/sys/netbt/l2cap_upper.c
+++ b/sys/netbt/l2cap_upper.c
@@ -33,6 +33,7 @@
 
 #include <sys/param.h>
 #include <sys/kernel.h>
+#include <sys/malloc.h>
 #include <sys/mbuf.h>
 #include <sys/proc.h>
 #include <sys/queue.h>
diff --git a/sys/netbt/rfcomm_dlc.c b/sys/netbt/rfcomm_dlc.c
index 904d415bcb..88c7706752 100644
--- a/sys/netbt/rfcomm_dlc.c
+++ b/sys/netbt/rfcomm_dlc.c
@@ -34,6 +34,7 @@
 
 #include <sys/param.h>
 #include <sys/kernel.h>
+#include <sys/malloc.h>
 #include <sys/mbuf.h>
 #include <sys/proc.h>
 #include <sys/systm.h>
diff --git a/sys/netbt/rfcomm_session.c b/sys/netbt/rfcomm_session.c
index 01d97feb91..135105336d 100644
--- a/sys/netbt/rfcomm_session.c
+++ b/sys/netbt/rfcomm_session.c
@@ -34,6 +34,7 @@
 
 #include <sys/param.h>
 #include <sys/kernel.h>
+#include <sys/malloc.h>
 #include <sys/mbuf.h>
 #include <sys/proc.h>
 #include <sys/systm.h>
diff --git a/sys/netbt/rfcomm_upper.c b/sys/netbt/rfcomm_upper.c
index e04bf3f2c1..387aebf73a 100644
--- a/sys/netbt/rfcomm_upper.c
+++ b/sys/netbt/rfcomm_upper.c
@@ -1,4 +1,3 @@
-/* $DragonFly: src/sys/netbt/rfcomm_upper.c,v 1.3 2008/06/20 20:52:29 aggelos Exp $ */
 /* $OpenBSD: src/sys/netbt/rfcomm_upper.c,v 1.4 2008/02/24 21:34:48 uwe Exp $ */
 /* $NetBSD: rfcomm_upper.c,v 1.10 2007/11/20 20:25:57 plunky Exp $ */
 
@@ -35,6 +34,7 @@
 
 #include <sys/param.h>
 #include <sys/kernel.h>
+#include <sys/malloc.h>
 #include <sys/mbuf.h>
 #include <sys/proc.h>
 #include <sys/systm.h>
diff --git a/sys/netbt/sco_upper.c b/sys/netbt/sco_upper.c
index 0d63a3ef4c..ecbf93d793 100644
--- a/sys/netbt/sco_upper.c
+++ b/sys/netbt/sco_upper.c
@@ -34,6 +34,7 @@
 
 #include <sys/param.h>
 #include <sys/kernel.h>
+#include <sys/malloc.h>
 #include <sys/mbuf.h>
 #include <sys/proc.h>
 #include <sys/systm.h>
-- 
2.23.0

